<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Shift Scheduler Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 100%;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .icon-btn {
            cursor: pointer;
            font-size: 24px;
            padding: 10px;
            transition: transform 0.3s, opacity 0.3s;
            opacity: 0.8;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
        }

        .icon-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .settings-icon:hover {
            transform: rotate(90deg) !important;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #ddd;
            display: none;
            flex-direction: column;
            gap: 20px;
            animation: slideDown 0.3s ease;
        }

        .controls.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .control-section {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .control-section-title {
            width: 100%;
            font-weight: 700;
            color: #2c3e50;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .controls label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .controls input, .controls select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 100px;
        }

        .controls input:focus, .controls select:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .controls button {
            padding: 10px 24px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .controls button:hover {
            background: #34495e;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .controls button:active {
            transform: translateY(0);
        }

        .btn-export {
            background: #27ae60;
        }

        .btn-export:hover {
            background: #229954;
        }

        .btn-overview {
            background: #3498db;
        }

        .btn-overview:hover {
            background: #2980b9;
        }

        .schedule-wrapper {
            padding: 20px;
        }

        .week-container {
            margin-bottom: 30px;
        }

        .week-title {
            background: #34495e;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 6px 6px 0 0;
            margin-bottom: 0;
        }

        .table-container {
            overflow-x: auto;
            border: 2px solid #34495e;
            border-radius: 0 0 6px 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            font-size: 13px;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .worker-name {
            background: #ecf0f1;
            font-weight: 700;
            font-size: 14px;
            color: #1a1a1a;
            text-align: left;
            padding-left: 15px;
            position: sticky;
            left: 0;
            z-index: 5;
            min-width: 150px;
        }

        .worker-name.manager {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
        }

        .manager-badge {
            display: inline-block;
            background: #f39c12;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 5px;
        }

        .day-header {
            font-size: 11px;
            min-width: 100px;
        }

        .weekend {
            background: #fff3cd;
        }

        .shift-cell {
            min-height: 40px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .shift-cell:hover {
            background: #f8f9fa;
        }

        .shift-cell input {
            width: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 12px;
            padding: 5px;
            outline: none;
        }

        .shift-cell input:focus {
            background: #e3f2fd;
        }

        .shift-display {
            font-size: 11px;
            font-weight: 600;
            color: #2c3e50;
            padding: 4px 8px;
            border-radius: 4px;
            background: #e8f5e9;
        }

        .shift-night {
            background: #e3f2fd;
            color: #1565c0;
        }

        .shift-day {
            background: #fff9c4;
            color: #f57f17;
        }

        .shift-evening {
            background: #fce4ec;
            color: #c2185b;
        }

        .shift-off {
            background: #ffccbc;
            color: #d84315;
            font-weight: 700;
        }

        .guide-section {
            padding: 20px;
            background: #f8f9fa;
            border-top: 2px solid #ddd;
        }

        .guide-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guide-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .guide-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .guide-box h3 {
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .guide-box ul {
            list-style: none;
            padding: 0;
        }

        .guide-box li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guide-box li:last-child {
            border-bottom: none;
        }

        .color-sample {
            display: inline-block;
            width: 60px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .legend {
            padding: 15px 20px;
            background: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 13px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .time-shortcuts {
            font-size: 12px;
            color: #666;
            padding: 10px 20px;
            background: #fff;
            border-top: 1px solid #ddd;
        }

        .time-shortcuts strong {
            color: #2c3e50;
        }

        .footer {
            padding: 15px 20px;
            background: #2c3e50;
            color: white;
            text-align: center;
            font-size: 12px;
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media print {
            body {
                padding: 0;
                background: white;
            }
            
            .container {
                box-shadow: none;
                page-break-inside: avoid;
            }
            
            .header-actions, .controls, .guide-section, .time-shortcuts {
                display: none !important;
            }
            
            .shift-cell input {
                border: none !important;
            }

            .table-container {
                overflow-x: visible !important;
                overflow-y: visible !important;
                border: 2px solid #34495e;
            }

            table {
                width: 100% !important;
                min-width: auto !important;
                page-break-inside: auto;
            }

            th, td {
                min-width: 60px !important;
                padding: 4px 2px !important;
                font-size: 9px !important;
            }

            .worker-name {
                min-width: 100px !important;
                font-size: 10px !important;
            }

            .shift-display {
                font-size: 8px !important;
                padding: 2px 4px !important;
            }

            .week-container {
                page-break-inside: avoid;
                page-break-after: always;
            }

            .week-container:last-child {
                page-break-after: auto;
            }

            .schedule-wrapper {
                padding: 10px 5px !important;
            }

            .day-header {
                min-width: 60px !important;
            }

            @page {
                size: landscape;
                margin: 0.5cm;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            .schedule-wrapper {
                padding: 10px;
            }

            .guide-content {
                grid-template-columns: 1fr;
            }
        }

        /* Export optimization */
        .export-mode .table-container {
            overflow-x: visible !important;
            border: 2px solid #34495e;
        }

        .export-mode table {
            width: 100% !important;
            min-width: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="header">
            <div class="header-content">
                <h1>üõ°Ô∏è Security Shift Scheduler Pro - November 2025</h1>
                <p>Bi-Weekly Shift Planning & Management</p>
            </div>
            <div class="header-actions">
                <div class="icon-btn" id="guideBtn" title="User Guide">üìñ</div>
                <div class="icon-btn btn-overview" id="overviewBtn" title="View Analytics">üìä</div>
                <div class="icon-btn settings-icon" id="settingsIcon" title="Settings">‚öôÔ∏è</div>
            </div>
        </div>

        <div class="controls" id="controls">
            <div class="control-section">
                <div class="control-section-title">üìÖ Schedule Period</div>
                <label for="monthSelect">Month:</label>
                <select id="monthSelect">
                    <option value="0">January</option>
                    <option value="1">February</option>
                    <option value="2">March</option>
                    <option value="3">April</option>
                    <option value="4">May</option>
                    <option value="5">June</option>
                    <option value="6">July</option>
                    <option value="7">August</option>
                    <option value="8">September</option>
                    <option value="9">October</option>
                    <option value="10" selected>November</option>
                    <option value="11">December</option>
                </select>
                <label for="yearInput">Year:</label>
                <input type="number" id="yearInput" min="2020" max="2100" value="2025">
                <button id="updateDateBtn">Update Calendar</button>
            </div>

            <div class="control-section">
                <div class="control-section-title">üë• Team Size</div>
                <label for="workerCount">Number of Workers:</label>
                <input type="number" id="workerCount" min="1" max="50" value="8">
                <button id="generateBtn">Generate Schedule</button>
            </div>

            <div class="control-section">
                <div class="control-section-title">üì§ Export & Save Options</div>
                <button id="exportImageBtn" class="btn-export">üì∏ Export as Image</button>
                <button id="exportJsonBtn" class="btn-export">üíæ Export Schedule Data</button>
                <button id="importJsonBtn" class="btn-export">üìÇ Import Schedule Data</button>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
                <button onclick="window.print()">üñ®Ô∏è Print Schedule</button>
            </div>
        </div>

        <div class="time-shortcuts">
            <strong>‚ö° Quick Time Entry:</strong> <code>11-7</code> = 11PM-7AM ‚Ä¢ <code>7-3</code> = 7AM-3PM ‚Ä¢ <code>3-11</code> = 3PM-11PM ‚Ä¢ <code>10-6</code> = 10AM-6PM ‚Ä¢ <code>off</code> = Day Off ‚Ä¢ Add <code>(m)</code> after name for Manager
        </div>

        <div class="schedule-wrapper">
            <div class="week-container">
                <div class="week-title">üìÜ Week 1 & 2 (Days 1-15)</div>
                <div class="table-container">
                    <table id="scheduleTable1">
                        <thead>
                            <tr id="headerRow1">
                                <th class="worker-name">Security Personnel</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleBody1">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="week-container">
                <div class="week-title">üìÜ Week 3 & 4 (Days 16-31)</div>
                <div class="table-container">
                    <table id="scheduleTable2">
                        <thead>
                            <tr id="headerRow2">
                                <th class="worker-name">Security Personnel</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleBody2">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-box weekend"></div>
                <span>Weekend</span>
            </div>
            <div class="legend-item">
                <div class="legend-box shift-night"></div>
                <span>Night Shift</span>
            </div>
            <div class="legend-item">
                <div class="legend-box shift-day"></div>
                <span>Day Shift</span>
            </div>
            <div class="legend-item">
                <div class="legend-box shift-evening"></div>
                <span>Evening Shift</span>
            </div>
            <div class="legend-item">
                <div class="legend-box shift-off"></div>
                <span>Day Off</span>
            </div>
        </div>

        <div class="guide-section" style="display: none;">
            <div class="guide-title">üìñ User Guide & Color Legend</div>
            <div class="guide-content">
                <div class="guide-box">
                    <h3>üé® Shift Color Codes</h3>
                    <ul>
                        <li><span class="color-sample shift-night"></span> <strong>Night Shift</strong> - 11PM-7AM</li>
                        <li><span class="color-sample shift-day"></span> <strong>Day Shift</strong> - 7AM-3PM, 10AM-6PM</li>
                        <li><span class="color-sample shift-evening"></span> <strong>Evening Shift</strong> - 3PM-11PM</li>
                        <li><span class="color-sample shift-off"></span> <strong>Day Off</strong> - No work scheduled</li>
                        <li><span class="color-sample weekend"></span> <strong>Weekend</strong> - Saturday/Sunday</li>
                    </ul>
                </div>

                <div class="guide-box">
                    <h3>‚å®Ô∏è Quick Entry Shortcuts</h3>
                    <ul>
                        <li><code>11-7</code> ‚Üí Converts to 11PM-7AM (Night)</li>
                        <li><code>7-3</code> ‚Üí Converts to 7AM-3PM (Day)</li>
                        <li><code>3-11</code> ‚Üí Converts to 3PM-11PM (Evening)</li>
                        <li><code>10-6</code> ‚Üí Converts to 10AM-6PM (Day)</li>
                        <li><code>off</code> ‚Üí Marks as Day Off</li>
                    </ul>
                </div>

                <div class="guide-box">
                    <h3>üë§ Personnel Management</h3>
                    <ul>
                        <li>Click worker names to edit them</li>
                        <li>Add <strong>(m)</strong> after name for Manager designation</li>
                        <li>Example: "John Smith (m)" shows as Manager</li>
                        <li>Managers highlighted with special border & badge</li>
                        <li>Click shift badges to edit existing entries</li>
                    </ul>
                </div>

                <div class="guide-box">
                    <h3>üíæ Save & Export Features</h3>
                    <ul>
                        <li><strong>Export Schedule Data:</strong> Save as JSON file</li>
                        <li><strong>Import Schedule Data:</strong> Load previously saved schedule</li>
                        <li><strong>Export as Image:</strong> Download full schedule as PNG</li>
                        <li><strong>Analytics Page:</strong> View hours, shift patterns & team insights</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer">
            Made by <strong>Keyran Lewis</strong> | Email: <a href="mailto:chrmxfinal@gmail.com">chrmxfinal@gmail.com</a>
        </div>
    </div>

    <script>
        let workers = [];
        let workerNames = {};
        let currentMonth = 10;
        let currentYear = 2025;
        let daysInMonth = 30;

        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        let scheduleData = {};

        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getDayOfWeek(day, month, year) {
            return new Date(year, month, day).getDay();
        }

        function getDayName(dayOfWeek) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            return days[dayOfWeek];
        }

        function parseTimeInput(input) {
            if (!input || input.trim() === '' || input === '--') return null;
            
            input = input.trim().toLowerCase();
            
            // Check for day off
            if (input === 'off' || input === 'OFF') {
                return { time: 'OFF', type: 'off' };
            }
            
            // Common shift patterns
            const patterns = {
                '11-7': { time: '11PM-7AM', type: 'night' },
                '7-3': { time: '7AM-3PM', type: 'day' },
                '3-11': { time: '3PM-11PM', type: 'evening' },
                '10-6': { time: '10AM-6PM', type: 'day' }
            };

            if (patterns[input]) {
                return patterns[input];
            }

            const timeRegex = /(\d{1,2})\s*[-‚Äìto]\s*(\d{1,2})/i;
            const match = input.match(timeRegex);
            
            if (match) {
                let start = parseInt(match[1]);
                let end = parseInt(match[2]);
                
                let startPeriod, endPeriod, shiftType;
                
                if (start === 11 && end === 7) {
                    startPeriod = 'PM'; endPeriod = 'AM'; shiftType = 'night';
                } else if (start === 7 && end === 3) {
                    startPeriod = 'AM'; endPeriod = 'PM'; shiftType = 'day';
                } else if (start === 3 && end === 11) {
                    startPeriod = 'PM'; endPeriod = 'PM'; shiftType = 'evening';
                } else if (start === 10 && end === 6) {
                    startPeriod = 'AM'; endPeriod = 'PM'; shiftType = 'day';
                } else if (start >= 7 && start < 12 && end <= 6) {
                    startPeriod = 'AM'; endPeriod = 'PM'; shiftType = 'day';
                } else if (start >= 12 || start < 7) {
                    if (end < start) {
                        startPeriod = 'PM'; endPeriod = 'AM'; shiftType = 'night';
                    } else {
                        startPeriod = 'PM'; endPeriod = 'PM'; shiftType = 'evening';
                    }
                } else {
                    startPeriod = 'AM'; endPeriod = 'PM'; shiftType = 'day';
                }
                
                return {
                    time: `${start}${startPeriod}-${end}${endPeriod}`,
                    type: shiftType
                };
            }
            
            return { time: input, type: 'day' };
        }

        function isManager(name) {
            return name.toLowerCase().includes('(m)');
        }

        function updateHeader() {
            const headerTitle = document.querySelector('.header h1');
            headerTitle.textContent = `üõ°Ô∏è Security Shift Scheduler Pro - ${monthNames[currentMonth]} ${currentYear}`;
        }

        function updateCalendar() {
            currentMonth = parseInt(document.getElementById('monthSelect').value);
            currentYear = parseInt(document.getElementById('yearInput').value);
            daysInMonth = getDaysInMonth(currentMonth, currentYear);
            
            updateHeader();
            generateSchedule();
        }

        function createShiftCell(workerIndex, day) {
            const cell = document.createElement('td');
            cell.className = 'shift-cell';
            
            const dayOfWeek = getDayOfWeek(day, currentMonth, currentYear);
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                cell.classList.add('weekend');
            }
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = '--';
            input.setAttribute('data-worker', workerIndex);
            input.setAttribute('data-day', day);
            
            input.addEventListener('blur', (e) => {
                const value = e.target.value.trim();
                const parsed = parseTimeInput(value);
                
                if (parsed && value !== '') {
                    const worker = e.target.getAttribute('data-worker');
                    const day = e.target.getAttribute('data-day');
                    
                    if (!scheduleData[worker]) {
                        scheduleData[worker] = {};
                    }
                    scheduleData[worker][day] = parsed;
                    
                    const display = document.createElement('div');
                    display.className = `shift-display shift-${parsed.type}`;
                    display.textContent = parsed.time;
                    display.onclick = () => {
                        cell.innerHTML = '';
                        cell.appendChild(input);
                        input.value = value;
                        input.focus();
                    };
                    
                    cell.innerHTML = '';
                    cell.appendChild(display);
                }
            });
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.target.blur();
                }
            });
            
            cell.appendChild(input);
            return cell;
        }

        function generateSchedule() {
            const workerCount = parseInt(document.getElementById('workerCount').value);
            
            if (workerCount < 1 || workerCount > 50) {
                alert('Please enter a number between 1 and 50');
                return;
            }

            workers = [];
            for (let i = 1; i <= workerCount; i++) {
                workers.push(`Worker ${i}`);
            }

            const midPoint = Math.ceil(daysInMonth / 2);
            
            const tbody1 = document.getElementById('scheduleBody1');
            const tbody2 = document.getElementById('scheduleBody2');
            tbody1.innerHTML = '';
            tbody2.innerHTML = '';
            
            const header1 = document.getElementById('headerRow1');
            const header2 = document.getElementById('headerRow2');
            header1.innerHTML = '<th class="worker-name">Security Personnel</th>';
            header2.innerHTML = '<th class="worker-name">Security Personnel</th>';
            
            for (let day = 1; day <= midPoint; day++) {
                const dayOfWeek = getDayOfWeek(day, currentMonth, currentYear);
                const dayName = getDayName(dayOfWeek);
                const th = document.createElement('th');
                th.className = 'day-header';
                th.innerHTML = `${day}<br>${dayName}`;
                header1.appendChild(th);
            }
            
            for (let day = midPoint + 1; day <= daysInMonth; day++) {
                const dayOfWeek = getDayOfWeek(day, currentMonth, currentYear);
                const dayName = getDayName(dayOfWeek);
                const th = document.createElement('th');
                th.className = 'day-header';
                th.innerHTML = `${day}<br>${dayName}`;
                header2.appendChild(th);
            }
            
            scheduleData = {};
            
            workers.forEach((worker, workerIndex) => {
                const row1 = document.createElement('tr');
                const nameCell1 = document.createElement('td');
                nameCell1.className = 'worker-name';
                nameCell1.contentEditable = true;
                nameCell1.textContent = workerNames[workerIndex] || worker;
                
                nameCell1.addEventListener('blur', (e) => {
                    const name = e.target.textContent.trim();
                    workerNames[workerIndex] = name;
                    
                    if (isManager(name)) {
                        nameCell1.classList.add('manager');
                        nameCell2.classList.add('manager');
                        if (!nameCell1.querySelector('.manager-badge')) {
                            const badge = document.createElement('span');
                            badge.className = 'manager-badge';
                            badge.textContent = 'MGR';
                            nameCell1.appendChild(badge);
                        }
                    } else {
                        nameCell1.classList.remove('manager');
                        nameCell2.classList.remove('manager');
                        const badge = nameCell1.querySelector('.manager-badge');
                        if (badge) badge.remove();
                    }
                    
                    nameCell2.textContent = name;
                    if (isManager(name) && !nameCell2.querySelector('.manager-badge')) {
                        const badge = document.createElement('span');
                        badge.className = 'manager-badge';
                        badge.textContent = 'MGR';
                        nameCell2.appendChild(badge);
                    }
                });
                
                if (isManager(workerNames[workerIndex] || worker)) {
                    nameCell1.classList.add('manager');
                    const badge = document.createElement('span');
                    badge.className = 'manager-badge';
                    badge.textContent = 'MGR';
                    nameCell1.appendChild(badge);
                }
                
                row1.appendChild(nameCell1);
                
                for (let day = 1; day <= midPoint; day++) {
                    row1.appendChild(createShiftCell(workerIndex, day));
                }
                tbody1.appendChild(row1);
                
                const row2 = document.createElement('tr');
                const nameCell2 = document.createElement('td');
                nameCell2.className = 'worker-name';
                nameCell2.contentEditable = true;
                nameCell2.textContent = workerNames[workerIndex] || worker;
                
                nameCell2.addEventListener('blur', (e) => {
                    const name = e.target.textContent.trim();
                    workerNames[workerIndex] = name;
                    
                    if (isManager(name)) {
                        nameCell1.classList.add('manager');
                        nameCell2.classList.add('manager');
                        const badge1 = nameCell1.querySelector('.manager-badge');
                        if (!badge1) {
                            const badge = document.createElement('span');
                            badge.className = 'manager-badge';
                            badge.textContent = 'MGR';
                            nameCell1.appendChild(badge);
                        }
                        if (!nameCell2.querySelector('.manager-badge')) {
                            const badge = document.createElement('span');
                            badge.className = 'manager-badge';
                            badge.textContent = 'MGR';
                            nameCell2.appendChild(badge);
                        }
                    } else {
                        nameCell1.classList.remove('manager');
                        nameCell2.classList.remove('manager');
                        const badge1 = nameCell1.querySelector('.manager-badge');
                        const badge2 = nameCell2.querySelector('.manager-badge');
                        if (badge1) badge1.remove();
                        if (badge2) badge2.remove();
                    }
                    
                    nameCell1.childNodes[0].textContent = name + ' ';
                });
                
                if (isManager(workerNames[workerIndex] || worker)) {
                    nameCell2.classList.add('manager');
                    const badge = document.createElement('span');
                    badge.className = 'manager-badge';
                    badge.textContent = 'MGR';
                    nameCell2.appendChild(badge);
                }
                
                row2.appendChild(nameCell2);
                
                for (let day = midPoint + 1; day <= daysInMonth; day++) {
                    row2.appendChild(createShiftCell(workerIndex, day));
                }
                tbody2.appendChild(row2);
            });

            document.querySelectorAll('.worker-name').forEach(cell => {
                cell.addEventListener('focus', () => {
                    cell.style.background = '#e3f2fd';
                });
            });
        }

        async function exportAsImage() {
            const settingsIcon = document.getElementById('settingsIcon');
            const overviewBtn = document.getElementById('overviewBtn');
            const guideBtn = document.getElementById('guideBtn');
            const controls = document.getElementById('controls');
            const timeShortcuts = document.querySelector('.time-shortcuts');
            const legend = document.querySelector('.legend');
            const wasControlsVisible = controls.classList.contains('active');
            
            // Hide UI elements
            settingsIcon.style.display = 'none';
            overviewBtn.style.display = 'none';
            guideBtn.style.display = 'none';
            controls.classList.remove('active');
            timeShortcuts.style.display = 'none';
            
            const container = document.getElementById('mainContainer');
            const tables = document.querySelectorAll('.table-container');
            const scheduleWrapper = document.querySelector('.schedule-wrapper');
            
            // Store original styles
            const originalStyles = {
                tables: [],
                wrapper: {
                    padding: scheduleWrapper.style.padding
                }
            };
            
            // Apply export styles
            scheduleWrapper.style.padding = '20px 10px';
            
            tables.forEach((tableContainer, index) => {
                const table = tableContainer.querySelector('table');
                originalStyles.tables[index] = {
                    containerOverflow: tableContainer.style.overflow,
                    tableMinWidth: table.style.minWidth,
                    tableWidth: table.style.width
                };
                
                // Remove scroll and make tables fit
                tableContainer.style.overflow = 'visible';
                table.style.minWidth = 'auto';
                table.style.width = '100%';
                
                // Make cells smaller for export
                const cells = table.querySelectorAll('th, td');
                cells.forEach(cell => {
                    if (!cell.classList.contains('worker-name')) {
                        cell.style.minWidth = '70px';
                        cell.style.padding = '6px 4px';
                        cell.style.fontSize = '10px';
                    } else {
                        cell.style.minWidth = '120px';
                        cell.style.fontSize = '11px';
                    }
                });
                
                // Make shift displays smaller
                const shiftDisplays = table.querySelectorAll('.shift-display');
                shiftDisplays.forEach(display => {
                    display.style.fontSize = '9px';
                    display.style.padding = '2px 4px';
                });
            });

            // Wait for layout to settle
            await new Promise(resolve => setTimeout(resolve, 100));

            try {
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    document.head.appendChild(script);
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                    });
                }

                // Capture with expanded dimensions
                const canvas = await html2canvas(container, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: -window.scrollY,
                    windowWidth: document.documentElement.scrollWidth,
                    windowHeight: document.documentElement.scrollHeight
                });

                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `Security_Shifts_${monthNames[currentMonth]}_${currentYear}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                });

            } catch (error) {
                alert('Error exporting image. Please try again.');
                console.error('Export error:', error);
            } finally {
                // Restore all original styles
                scheduleWrapper.style.padding = originalStyles.wrapper.padding;
                
                tables.forEach((tableContainer, index) => {
                    const table = tableContainer.querySelector('table');
                    const orig = originalStyles.tables[index];
                    
                    tableContainer.style.overflow = orig.containerOverflow;
                    table.style.minWidth = orig.tableMinWidth;
                    table.style.width = orig.tableWidth;
                    
                    // Reset cell styles
                    const cells = table.querySelectorAll('th, td');
                    cells.forEach(cell => {
                        cell.style.minWidth = '';
                        cell.style.padding = '';
                        cell.style.fontSize = '';
                    });
                    
                    // Reset shift display styles
                    const shiftDisplays = table.querySelectorAll('.shift-display');
                    shiftDisplays.forEach(display => {
                        display.style.fontSize = '';
                        display.style.padding = '';
                    });
                });
                
                // Restore UI elements
                settingsIcon.style.display = 'block';
                overviewBtn.style.display = 'block';
                guideBtn.style.display = 'block';
                timeShortcuts.style.display = 'block';
                if (wasControlsVisible) {
                    controls.classList.add('active');
                }
            }
        }

        function exportScheduleData() {
            const exportData = {
                month: currentMonth,
                year: currentYear,
                workerNames: workerNames,
                scheduleData: scheduleData,
                daysInMonth: daysInMonth,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = `Security_Schedule_${monthNames[currentMonth]}_${currentYear}.json`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importScheduleData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    currentMonth = data.month;
                    currentYear = data.year;
                    workerNames = data.workerNames || {};
                    scheduleData = data.scheduleData || {};
                    daysInMonth = data.daysInMonth;
                    
                    document.getElementById('monthSelect').value = currentMonth;
                    document.getElementById('yearInput').value = currentYear;
                    document.getElementById('workerCount').value = Object.keys(workerNames).length || 8;
                    
                    updateHeader();
                    generateSchedule();
                    
                    // Populate the schedule with imported data
                    Object.keys(scheduleData).forEach(workerIndex => {
                        Object.keys(scheduleData[workerIndex]).forEach(day => {
                            const shiftData = scheduleData[workerIndex][day];
                            const input = document.querySelector(`input[data-worker="${workerIndex}"][data-day="${day}"]`);
                            
                            if (input && shiftData) {
                                const cell = input.parentElement;
                                const display = document.createElement('div');
                                display.className = `shift-display shift-${shiftData.type}`;
                                display.textContent = shiftData.time;
                                display.onclick = () => {
                                    cell.innerHTML = '';
                                    cell.appendChild(input);
                                    input.value = shiftData.time;
                                    input.focus();
                                };
                                
                                cell.innerHTML = '';
                                cell.appendChild(display);
                            }
                        });
                    });
                    
                    alert('Schedule imported successfully!');
                } catch (error) {
                    alert('Error importing schedule. Please check the file format.');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }

        function openOverviewPage() {
            // Calculate analytics
            const analytics = calculateAnalytics();
            
            // Create overview page
            const overviewWindow = window.open('', '_blank');
            overviewWindow.document.write(generateOverviewHTML(analytics));
            overviewWindow.document.close();
        }

        function openGuidePage() {
            const guideWindow = window.open('', '_blank');
            guideWindow.document.write(generateGuideHTML());
            guideWindow.document.close();
        }

        function generateGuideHTML() {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>User Guide - Security Shift Scheduler Pro</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            padding: 20px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            min-height: 100vh;
                        }
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                            background: white;
                            border-radius: 12px;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                            overflow: hidden;
                        }
                        .hero {
                            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                            color: white;
                            padding: 60px 40px;
                            text-align: center;
                        }
                        .hero h1 {
                            font-size: 42px;
                            margin-bottom: 15px;
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                        }
                        .hero p {
                            font-size: 18px;
                            opacity: 0.95;
                            max-width: 600px;
                            margin: 0 auto;
                            line-height: 1.6;
                        }
                        .content { padding: 40px; }
                        .section {
                            margin-bottom: 40px;
                            padding: 30px;
                            background: #f8f9fa;
                            border-radius: 10px;
                            border-left: 5px solid #3498db;
                        }
                        .section-title {
                            font-size: 24px;
                            font-weight: 700;
                            color: #2c3e50;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 12px;
                        }
                        .feature-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                            gap: 20px;
                            margin-top: 20px;
                        }
                        .feature-card {
                            background: white;
                            padding: 20px;
                            border-radius: 8px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                            transition: transform 0.3s, box-shadow 0.3s;
                        }
                        .feature-card:hover {
                            transform: translateY(-5px);
                            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                        }
                        .feature-card h3 {
                            color: #2c3e50;
                            font-size: 18px;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        .feature-card ul {
                            list-style: none;
                            padding: 0;
                        }
                        .feature-card li {
                            padding: 10px 0;
                            border-bottom: 1px solid #eee;
                            font-size: 14px;
                            line-height: 1.6;
                        }
                        .feature-card li:last-child {
                            border-bottom: none;
                        }
                        .color-demo {
                            display: flex;
                            align-items: center;
                            gap: 12px;
                            margin: 8px 0;
                        }
                        .color-sample {
                            display: inline-block;
                            width: 80px;
                            height: 30px;
                            border-radius: 5px;
                            border: 2px solid #ddd;
                            font-size: 10px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                        }
                        .shift-night {
                            background: #e3f2fd;
                            color: #1565c0;
                            border-color: #1565c0;
                        }
                        .shift-day {
                            background: #fff9c4;
                            color: #f57f17;
                            border-color: #f57f17;
                        }
                        .shift-evening {
                            background: #fce4ec;
                            color: #c2185b;
                            border-color: #c2185b;
                        }
                        .shift-off {
                            background: #ffccbc;
                            color: #d84315;
                            border-color: #d84315;
                        }
                        .weekend {
                            background: #fff3cd;
                            color: #856404;
                            border-color: #856404;
                        }
                        .shortcut-box {
                            background: #2c3e50;
                            color: white;
                            padding: 12px 20px;
                            border-radius: 6px;
                            font-family: 'Courier New', monospace;
                            font-size: 16px;
                            margin: 10px 0;
                            display: inline-block;
                        }
                        .tip-box {
                            background: #d1ecf1;
                            border-left: 4px solid #0c5460;
                            padding: 15px 20px;
                            margin: 20px 0;
                            border-radius: 4px;
                        }
                        .tip-box strong {
                            color: #0c5460;
                            display: block;
                            margin-bottom: 8px;
                        }
                        .back-link {
                            display: inline-block;
                            margin: 20px 0;
                            padding: 12px 30px;
                            background: #3498db;
                            color: white;
                            text-decoration: none;
                            border-radius: 6px;
                            font-weight: 600;
                            font-size: 16px;
                            transition: background 0.3s;
                        }
                        .back-link:hover {
                            background: #2980b9;
                        }
                        .footer {
                            padding: 25px;
                            background: #2c3e50;
                            color: white;
                            text-align: center;
                        }
                        .footer a {
                            color: #3498db;
                            text-decoration: none;
                        }
                        .footer a:hover {
                            text-decoration: underline;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="hero">
                            <h1>üìñ Welcome to Security Shift Scheduler Pro</h1>
                            <p>Your comprehensive guide to managing security shifts efficiently. Learn all the features and shortcuts to maximize your productivity.</p>
                        </div>
                        
                        <div class="content">
                            <a href="#" onclick="window.close(); return false;" class="back-link">‚Üê Back to Scheduler</a>
                            
                            <div class="section">
                                <div class="section-title">üé® Understanding Shift Colors</div>
                                <p style="margin-bottom: 20px;">Each shift type is color-coded for instant visual recognition:</p>
                                <div class="color-demo">
                                    <span class="color-sample shift-night">Night</span>
                                    <span><strong>Night Shift</strong> - 11PM to 7AM (8 hours) - Blue background</span>
                                </div>
                                <div class="color-demo">
                                    <span class="color-sample shift-day">Day</span>
                                    <span><strong>Day Shift</strong> - 7AM to 3PM or 10AM to 6PM (8 hours) - Yellow background</span>
                                </div>
                                <div class="color-demo">
                                    <span class="color-sample shift-evening">Evening</span>
                                    <span><strong>Evening Shift</strong> - 3PM to 11PM (8 hours) - Pink background</span>
                                </div>
                                <div class="color-demo">
                                    <span class="color-sample shift-off">OFF</span>
                                    <span><strong>Day Off</strong> - Worker not scheduled - Orange/Red background</span>
                                </div>
                                <div class="color-demo">
                                    <span class="color-sample weekend">Weekend</span>
                                    <span><strong>Weekend Days</strong> - Saturday and Sunday - Light yellow cell background</span>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">‚ö° Quick Entry Shortcuts</div>
                                <p style="margin-bottom: 20px;">Save time by using these shortcuts when entering shifts:</p>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div>
                                        <div class="shortcut-box">11-7</div>
                                        <p style="margin-top: 8px; font-size: 14px;">Automatically converts to <strong>11PM-7AM</strong></p>
                                    </div>
                                    <div>
                                        <div class="shortcut-box">7-3</div>
                                        <p style="margin-top: 8px; font-size: 14px;">Automatically converts to <strong>7AM-3PM</strong></p>
                                    </div>
                                    <div>
                                        <div class="shortcut-box">3-11</div>
                                        <p style="margin-top: 8px; font-size: 14px;">Automatically converts to <strong>3PM-11PM</strong></p>
                                    </div>
                                    <div>
                                        <div class="shortcut-box">10-6</div>
                                        <p style="margin-top: 8px; font-size: 14px;">Automatically converts to <strong>10AM-6PM</strong></p>
                                    </div>
                                    <div>
                                        <div class="shortcut-box">off</div>
                                        <p style="margin-top: 8px; font-size: 14px;">Marks the day as <strong>Day Off</strong></p>
                                    </div>
                                </div>
                                <div class="tip-box">
                                    <strong>üí° Pro Tip:</strong>
                                    After typing the shortcut, press Enter or click outside the cell to apply the formatting instantly!
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">üë§ Personnel Management</div>
                                <div class="feature-grid">
                                    <div class="feature-card">
                                        <h3>‚úèÔ∏è Editing Names</h3>
                                        <ul>
                                            <li>Click any worker name to edit it</li>
                                            <li>Changes apply to both week tables automatically</li>
                                            <li>Press Enter or click away to save</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üëî Manager Designation</h3>
                                        <ul>
                                            <li>Add <strong>(m)</strong> after any name</li>
                                            <li>Example: "Sarah Johnson (m)"</li>
                                            <li>Gets special yellow highlight and MGR badge</li>
                                            <li>Stands out visually in the schedule</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üéØ Editing Shifts</h3>
                                        <ul>
                                            <li>Click on any colored shift badge to edit</li>
                                            <li>Type new shortcut and press Enter</li>
                                            <li>Leave blank to remove shift assignment</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">üíæ Save, Export & Analytics</div>
                                <div class="feature-grid">
                                    <div class="feature-card">
                                        <h3>üì• Export Schedule Data</h3>
                                        <ul>
                                            <li>Saves complete schedule as JSON file</li>
                                            <li>Includes all workers, shifts, and settings</li>
                                            <li>Perfect for backups and sharing</li>
                                            <li>Can be imported later to continue editing</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üìÇ Import Schedule Data</h3>
                                        <ul>
                                            <li>Load previously saved JSON files</li>
                                            <li>Restores all schedule information</li>
                                            <li>Great for monthly templates</li>
                                            <li>Preserves worker names and shifts</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üì∏ Export as Image</h3>
                                        <ul>
                                            <li>Downloads full schedule as PNG image</li>
                                            <li>High resolution for printing or sharing</li>
                                            <li>Captures both week tables</li>
                                            <li>Perfect for posting or emailing</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üìä Analytics Dashboard</h3>
                                        <ul>
                                            <li>View total hours per worker</li>
                                            <li>See days worked vs days off</li>
                                            <li>Identify workers on same shifts</li>
                                            <li>Track shift type distribution</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">‚öôÔ∏è Settings & Customization</div>
                                <div class="feature-grid">
                                    <div class="feature-card">
                                        <h3>üìÖ Schedule Period</h3>
                                        <ul>
                                            <li>Select any month from dropdown</li>
                                            <li>Enter any year (2020-2100)</li>
                                            <li>Click "Update Calendar" to apply</li>
                                            <li>Automatically calculates correct days and weekends</li>
                                        </ul>
                                    </div>
                                    <div class="feature-card">
                                        <h3>üë• Team Size</h3>
                                        <ul>
                                            <li>Set number of workers (1-50)</li>
                                            <li>Click "Generate Schedule" to create tables</li>
                                            <li>Add or remove workers as needed</li>
                                            <li>Each worker gets a row in both week tables</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-title">üñ®Ô∏è Printing Tips</div>
                                <div class="tip-box">
                                    <strong>üìÑ For Best Print Results:</strong>
                                    <ul style="margin-top: 10px;">
                                        <li>‚Ä¢ Use landscape orientation for full schedules</li>
                                        <li>‚Ä¢ Set margins to "Narrow" in print settings</li>
                                        <li>‚Ä¢ Enable "Background graphics" to print colors</li>
                                        <li>‚Ä¢ Use Ctrl+P (Cmd+P on Mac) for quick print</li>
                                    </ul>
                                </div>
                            </div>

                            <a href="#" onclick="window.close(); return false;" class="back-link">‚Üê Back to Scheduler</a>
                        </div>

                        <div class="footer">
                            Made by <strong>Keyran Lewis</strong> | Email: <a href="mailto:chrmxfinal@gmail.com">chrmxfinal@gmail.com</a>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        function calculateAnalytics() {
            const analytics = {
                workers: {},
                shiftPatterns: {},
                totalHours: {},
                daysWorked: {},
                daysOff: {},
                shiftPairs: {}
            };

            // Calculate hours per shift type
            const shiftHours = {
                'night': 8,    // 11PM-7AM
                'day': 8,      // 7AM-3PM or 10AM-6PM
                'evening': 8,  // 3PM-11PM
                'off': 0
            };

            Object.keys(scheduleData).forEach(workerIndex => {
                const workerName = workerNames[workerIndex] || `Worker ${parseInt(workerIndex) + 1}`;
                
                analytics.workers[workerName] = {
                    shifts: {},
                    totalHours: 0,
                    daysWorked: 0,
                    daysOff: 0
                };

                Object.keys(scheduleData[workerIndex]).forEach(day => {
                    const shift = scheduleData[workerIndex][day];
                    
                    if (shift.type === 'off') {
                        analytics.workers[workerName].daysOff++;
                    } else {
                        analytics.workers[workerName].daysWorked++;
                        analytics.workers[workerName].totalHours += shiftHours[shift.type] || 8;
                        
                        if (!analytics.workers[workerName].shifts[shift.type]) {
                            analytics.workers[workerName].shifts[shift.type] = 0;
                        }
                        analytics.workers[workerName].shifts[shift.type]++;
                    }

                    // Track shift patterns for each day
                    if (!analytics.shiftPatterns[day]) {
                        analytics.shiftPatterns[day] = {};
                    }
                    if (!analytics.shiftPatterns[day][shift.time]) {
                        analytics.shiftPatterns[day][shift.time] = [];
                    }
                    analytics.shiftPatterns[day][shift.time].push(workerName);
                });
            });

            // Find workers with same shifts
            Object.keys(analytics.shiftPatterns).forEach(day => {
                Object.keys(analytics.shiftPatterns[day]).forEach(shiftTime => {
                    const workersOnShift = analytics.shiftPatterns[day][shiftTime];
                    if (workersOnShift.length > 1) {
                        const key = workersOnShift.sort().join(' & ');
                        if (!analytics.shiftPairs[key]) {
                            analytics.shiftPairs[key] = 0;
                        }
                        analytics.shiftPairs[key]++;
                    }
                });
            });

            return analytics;
        }

        function generateOverviewHTML(analytics) {
            const workersHTML = Object.keys(analytics.workers).map(name => {
                const data = analytics.workers[name];
                const shiftsBreakdown = Object.keys(data.shifts).map(type => 
                    `<span class="shift-tag shift-${type}">${type}: ${data.shifts[type]} days</span>`
                ).join(' ');

                return `
                    <tr>
                        <td style="font-weight: 700; color: #2c3e50;">${name}</td>
                        <td style="text-align: center; font-size: 18px; font-weight: 700; color: #27ae60;">${data.totalHours} hrs</td>
                        <td style="text-align: center;">${data.daysWorked}</td>
                        <td style="text-align: center;">${data.daysOff}</td>
                        <td>${shiftsBreakdown}</td>
                    </tr>
                `;
            }).join('');

            const pairsHTML = Object.keys(analytics.shiftPairs).map(pair => {
                return `
                    <tr>
                        <td style="font-weight: 600;">${pair}</td>
                        <td style="text-align: center; font-weight: 700; color: #3498db;">${analytics.shiftPairs[pair]} days</td>
                    </tr>
                `;
            }).join('');

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Schedule Analytics - ${monthNames[currentMonth]} ${currentYear}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            padding: 20px;
                            background: #f5f5f5;
                        }
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                            background: white;
                            border-radius: 8px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                            overflow: hidden;
                        }
                        .header {
                            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                            color: white;
                            padding: 30px;
                            text-align: center;
                        }
                        .header h1 { font-size: 28px; margin-bottom: 10px; }
                        .header p { opacity: 0.9; }
                        .content { padding: 30px; }
                        .section {
                            margin-bottom: 40px;
                            padding: 20px;
                            background: #f8f9fa;
                            border-radius: 8px;
                        }
                        .section-title {
                            font-size: 20px;
                            font-weight: 700;
                            color: #2c3e50;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            background: white;
                            border-radius: 6px;
                            overflow: hidden;
                        }
                        th, td {
                            padding: 12px;
                            text-align: left;
                            border-bottom: 1px solid #ddd;
                        }
                        th {
                            background: #34495e;
                            color: white;
                            font-weight: 600;
                        }
                        tr:last-child td { border-bottom: none; }
                        tr:hover { background: #f8f9fa; }
                        .shift-tag {
                            display: inline-block;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 11px;
                            font-weight: 600;
                            margin: 2px;
                        }
                        .shift-night { background: #e3f2fd; color: #1565c0; }
                        .shift-day { background: #fff9c4; color: #f57f17; }
                        .shift-evening { background: #fce4ec; color: #c2185b; }
                        .shift-off { background: #ffccbc; color: #d84315; }
                        .back-link {
                            display: inline-block;
                            margin: 20px 0;
                            padding: 10px 20px;
                            background: #3498db;
                            color: white;
                            text-decoration: none;
                            border-radius: 4px;
                            font-weight: 600;
                        }
                        .back-link:hover { background: #2980b9; }
                        .footer {
                            padding: 20px;
                            background: #2c3e50;
                            color: white;
                            text-align: center;
                        }
                        .footer a { color: #3498db; text-decoration: none; }
                        @media print {
                            .back-link { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1>üìä Schedule Analytics & Overview</h1>
                            <p>${monthNames[currentMonth]} ${currentYear} - Comprehensive Report</p>
                        </div>
                        
                        <div class="content">
                            <a href="#" onclick="window.close(); return false;" class="back-link">‚Üê Back to Schedule</a>
                            
                            <div class="section">
                                <div class="section-title">üë• Worker Hours & Attendance</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Worker Name</th>
                                            <th style="text-align: center;">Total Hours</th>
                                            <th style="text-align: center;">Days Worked</th>
                                            <th style="text-align: center;">Days Off</th>
                                            <th>Shift Breakdown</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${workersHTML || '<tr><td colspan="5" style="text-align: center; color: #999;">No schedule data available</td></tr>'}
                                    </tbody>
                                </table>
                            </div>

                            <div class="section">
                                <div class="section-title">ü§ù Workers on Same Shifts</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Worker Pair</th>
                                            <th style="text-align: center;">Days Together</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${pairsHTML || '<tr><td colspan="2" style="text-align: center; color: #999;">No overlapping shifts found</td></tr>'}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="footer">
                            Made by <strong>Keyran Lewis</strong> | Email: <a href="mailto:chrmxfinal@gmail.com">chrmxfinal@gmail.com</a>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        generateSchedule();

        document.getElementById('settingsIcon').addEventListener('click', () => {
            document.getElementById('controls').classList.toggle('active');
        });

        document.getElementById('generateBtn').addEventListener('click', generateSchedule);
        document.getElementById('updateDateBtn').addEventListener('click', updateCalendar);
        document.getElementById('exportImageBtn').addEventListener('click', exportAsImage);
        document.getElementById('exportJsonBtn').addEventListener('click', exportScheduleData);
        document.getElementById('overviewBtn').addEventListener('click', openOverviewPage);
        document.getElementById('guideBtn').addEventListener('click', openGuidePage);
        
        document.getElementById('importJsonBtn').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });
        
        document.getElementById('fileInput').addEventListener('change', importScheduleData);

        document.getElementById('workerCount').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateSchedule();
            }
        });

        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });
    </script>
</body>
</html>